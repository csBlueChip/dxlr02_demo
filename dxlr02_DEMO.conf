#------------------------------------------------------------------------------
# Comprehensive demo
#

#------------------------------------------------------------------------------
# ALL COMMENTS AND BLANK LINES ARE *COMPLETELY* ESCHEWED
# ALL LINES *MUST* BE AT INDENTATION LEVEL 0
#
# Ref:
# https://drive.google.com/drive/u/0/folders/15rVqecBOT4kS-NVYTY_DugkRwk0Vg_fX
# DX-LR02-900T22D Serial port application guide.pdf
#

#------------------------------------------------------------------------------
# DO NOT MOVE THIS BLOCK
# DO NOT PUT ANYTHING (other than comments) ABOVE THIS BLOCK
# DO NOT REMOVE THE *EXACTLY TWO* VARIABLES IN THIS BLOCK
# BOTH variable values MUST be enclosed in 'apostrophes'
#

# ==========
# device mount location
# `sudo dmesg -w`, and connect the device
#     usb 2-2.1: ch341-uart converter now attached to ttyUSB0
DEV='/dev/ttyUSB0'

# ==========
# Feel free to change the STTY values ...if you know what you are doing
# Baud rate MUST be first
#
#name:baud  8data   1stop    noParity   noXon/Xoff   noRts/Cts  noEcho  noXlat
#lr02:BAUD           STOP      PARI
STTY='9600   cs8   -cstopb   -parenb   -ixon -ixoff  -crtscts   -echo    raw'

#------------------------------------------------------------------------------
# THIS IS THE GENERAL ENTRY BLOCK
#

# ----------
# Enter AT mode
+++

# ----------
# HELO - OK
AT

# ----------
# Dump config
AT+HELP

#------------------------------------------------------------------------------
# WHATEVER QUERY OR CONFIG COMMANDS YOUR LITTLE HEART DESIRES
#     Key : *[default value]
#
# There is NO reason to call `AT+FOO` before and/or after you set it [AT+FOO<n>]
# ...it is just done here to show a comprehensive demo of all the commands
#

#------------------------------------------------------------------------------
# THIS IS THE SERIAL PORT BETWEEN THE LR02 AND THE PC
# If you change anything in this block, you will need to update:  STTY='...'

# ----------
# Baud Rate: {1-> 1200, 2-> 2400, 3-> 4800, *4->  9600,
#             5->19200, 6->38400, 7->57600,  8->115200, 9->128000}
AT+BAUD
AT+BAUD4
AT+BAUD

# ----------
# Stop Bits: {*1->1, 2->2}  [application guide is wrong]
AT+STOP
AT+STOP1
AT+STOP

# ----------
# Parity: {*0->None, 1->Odd, 2->Even}
AT+PARI
AT+PARI0
AT+PARI

#------------------------------------------------------------------------------
# THIS IS THE "UNIQUE" LoRa CONFIGURATION
#

# ----------
# Device Address/MAC: {00,00 .. *FF,FF}           (*0xFFFF == 65535.0)
#                             [unprefixed, comma-separated, hex bytes]
# If you supply a MAC address to the processor, this will be overridden
AT+MAC
AT+MACDE,B1
AT+MAC

#------------------------------------------------------------------------------
# THIS IS THE "COMMON" LoRa CONFIGURATION
#

# ----------
# Working Mode: {*0->Transparent, 1->Fixed,          2->Broadcast}
#           Tx:   [data]          [mac][chan][data]  [chan][data]
AT+MODE
AT+MODE0
AT+MODE

# ----------
# Air Rate: {*0 .. 7}
#   *0 = more distance, less data
#    7 = less distance, more data
AT+LEVEL
AT+LEVEL0
AT+LEVEL

# ----------
# Working Channel: {*00 .. A2} [unprefixed hex values] (0xA2 == 162.0)
#   Frequency = 850'000'000Hz + (channel * 500'000)
#   Range     = 850Mhz .. 931MHz
AT+CHANNEL
AT+CHANNEL0
AT+CHANNEL

# ----------
# Power Level: {0 .. 22} dB
#   More power => more distance
#   Less power => better battery life
AT+POWE
AT+POWE20
AT+POWE

# ----------
# Bandwidth: {*0->125KHz}  [LR02 supports only 125KHz]
AT+BW

# ----------
# RF Coding Rate: {1->4/5, *2->4/6, 3->4/7, 4->4/8}
#                 [where N is the number of bits of ECC data]
#   *2 : 4 Data bits + 2 ECC bits -> 6 bits required for every 4 bits of data
#     Lower  coding rate -> Faster, less reliable transmission
#     Higher coding rate -> Slower, more reliable transmission
AT+CR
AT+CR2
AT+CR

# ----------
# Spread Factor: {5 .. *12}
#   The time taken to Tx a single symbol each step HALVES the data rate
#   eg. SF7 is FOUR times slower than SF5
#       Low  SF -> Speed:Fast, Range:Short, Airtime:Low,  Reception:Poor
#      *High SF -> Speed:Slow, Range:Long,  Airtime:High, Reception:Good
AT+SF
AT+SF12
AT+SF

# ----------
# CRC Checking: {*0->Off, 1->On}
# CRC allows data to be validated, at the cost of slower transmissions
AT+CRC
AT+CRC0
AT+CRC

# ----------
# Iq Singal/Phase Flip: {*0, 1}
# "to achieve different functions or optimize performance" !?
AT+IQ
AT+IQ0
AT+IQ

#------------------------------------------------------------------------------
# DUMP THE FINAL RESULT AND RESET THE DEVICE
#

# ----------
# Dump the new config
AT+HELP

# ----------
# After any edits you MUST:  Reset the device
AT+RESET

# ----------
# Otherwise just:  Exit AT mode -> Transmission mode  [commented out here]
#+++

#------------------------------------------------------------------------------
# THE FACTORY RESET COMMAND

# ----------
# Reset to factory defaults [commented out for sanity]
#AT+DEFAULT

#[EOF]
